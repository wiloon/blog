---
title: CGI
author: "-"
date: 2011-10-16T09:51:42+00:00
url: /?p=1077
categories:
  - Development
tags:
  - reprint
---
## CGI

CGI(Common Gateway Interface)，通用网关接口

通用网关接口，简称CGI，是一种根据请求信息动态产生回应内容的技术。通过CGI，Web 服务器可以将根据请求不同启动不同的外部程序，并将请求内容转发给该程序，在程序执行结束后，将执行结果作为回应返回给客户端。也就是说，对于每个请求，都要产生一个新的进程进行处理。因为每个进程都会占有很多服务器的资源和时间，这就导致服务器无法同时处理很多的并发请求。另外CGI程序都是与操作系统平台相关的，虽然在互联网爆发的初期，CGI为开发互联网应用做出了很大的贡献，但是随着技术的发展，开始逐渐衰落。

CGI: 通用网关接口

Common Gateway Interface，简称CGI。在物理上是一段程序，运行在服务器上，提供同客户端 HTML页面的接口。这样说大概还不好理解。那么我们看一个实际例子:  现在的个人主页上大部分都有一个留言本。留言本的工作是这样的: 先由用户在客户端输入一些信息，如名字之类的东西。接着用户按一下"留言" (到目前为止工作都在客户端) ，浏览器把这些信息传送到服务器的CGI目录下特定的cgi程序中，于是cgi程序在服务器上按照预定的方法进行处理。在本例中就是把用户提交的信息存入指定的文件中。然后cgi程序给客户端发送一个信息，表示请求的任务已经结束。此时用户在浏览器里将看到"留言结束"的字样。整个过程结束。
  
功能
  
绝大多数的CGI程序被用来解释处理来自表单的输入信息，并在服务器产生相应的处理，或将相应的信息反馈给浏览器。CGI程序使网页具有交互功能。
  
运行环境
  
CGI程序最初在UNIX操作系统上CERN或NCSA格式的服务器上运行。
  
在其它操作系统 (如: Windows NT及Windows 95等) 的服务器上也广泛地使用CGI程序，同时它也适用于各种类型机器。
  
处理步骤
  
⑴通过Internet把用户请求送到服务器。
  
⑵服务器接收用户请求并交给CGI程序处理。
  
⑶CGI程序把处理结果传送给服务器。
  
⑷服务器把结果送回到用户。
  
服务器配置
  
CGI程序不是放在服务器上就能顺利运行，如果要想使其在服务器上顺利的运行并准确的处理用户的请求，则须对所使用的服务器进行必要的设置。
  
配置: 根据所使用的服务器类型以及它的设置把CGI程序放在某一特定的目录中或使其带有特定的扩展名。
  
⑴CREN格式服务器的配置: 
  
编辑CREN格式服务器的配置文件 (通常为/etc/httpd.conf) 在文件中加入: Exec cgi-bin/*/home/www/cgi-bin/*.exec。命令中出现的第一个参数cgi-bin/*指出了在URL中出现的目录名字，并表示它出现在系统主机后的第一个目录中，如: http://edgar.stern.nyn.\***/cgi-bin/。命令中的第二个参数表示CGI程序目录放在系统中的真实路径。
  
CGI目录除了可以跟网络文件放在同一目录中，也可以放在系统的其它目录中，但必须保证在你的系统中也具有同样的目录。在对服务器完成设置后，须重新启动服务器 (除非HTTP服务器是用inetd启动的) 。
  
⑵NCSA格式服务器的配置
  
在NCSA格式服务器上有两种方法进行设置: 
  
①在srm.conf文件 (通常在conf目录下) 中加入: Script Alias/cgi-bin/cgi-bin/。Script Alias命令指出某一目录下的文件是可执行程序，且这个命令是用来执行这些程序的；此命令的两个参数与CERN格式服务器中的Exec命令的参数的含意一样。
  
②在srm.conf文件加入: Add type application/x-httpd-cgi.cgi。此命令表示在服务器上增加了一种新的文件类型，其后第一个参数为CGI程序的MIME类型，第二个参数是文件的扩展名，表示以这一扩展名为扩展名的文件是CGI程序。
  
在用上述方法之一设置服务器后，都得重新启动服务器 (除非HTTP服务器是用inetd启动的) 。
  
编写语言
  
CGI可以用任何一种语言编写，只要这种语言具有标准输入、输出和环境变量。对初学者来说，最好选用易于归档和能有效表示大量数据结构的语言，例如UNIX环境中: 
  
· Perl (Practical Extraction and Report Language)
  
· Bourne Shell或者Tcl (Tool Command Language)
  
· PHP(Hypertext Preprocessor))
  
由于C语言有较强的平台无关性，所以也是编写CGI程序的首选。
  
Windows环境中: 
  
· C和C++
  
由于Internet上大部分服务器使用的是UNIX操作系统，且几乎任一UNIX操作系统中都有Bourne Shell，因而后面讲述的例子中大部分是用Bourne Shell编写的。
  
最终Perl由于其跨操作系统、易于修改的特性成为了CGI的主流编写语言，以至于一般的"cgi程序"就是Perl程序。
  
环境变量列表
  
SERVER-NAME: 运行CGI序为机器名或IP地址。
  
SERVER-INTERFACE: WWW服务器的类型，如: CERN型或NCSA型。
  
SERVER-PROTOCOL: 通信协议，应当是HTTP/1.0。
  
SERVER-PORT: TCP端口，一般说来web端口是80。
  
HTTP-ACCEPT: HTTP定义的浏览器能够接受的数据类型。
  
HTTP-REFERER:  发送表单的文件URL。 (并非所有的浏览器都传送这一变量) 
  
HTTP-USER-AGENT: 发送表单的浏览器的有关信息。
  
GETWAY-INTERFACE: CGI程序的版本，在UNIX下为 CGI/1.1。
  
PATH-TRANSLATED:  PATH-INFO中包含的实际路径名。
  
PATH-INFO: 浏览器用GET方式发送数据时的附加路径。
  
SCRIPT-NAME:  CGI程序的路径名。
  
QUERY-STRING: 表单输入的数据，URL中问号后的内容。
  
REMOTE-HOST: 发送程序的主机名，不能确定该值。
  
REMOTE-ADDR: 发送程序的机器的IP地址。
  
REMOTE-USER: 发送程序的人名。
  
CONTENT-TYPE: POST发送，一般为application/xwww-form-urlencoded。
  
CONTENT-LENGTH: POST方法输入的数据的字节数。
  
优点
  
CGI可以为我们提供许多HTML无法做到的功能。比如 a.一个记数器 b.顾客信息表格的提交以及统计 c.搜索程序 d.WEB数据库，用Html是没有办法记住客户的任何信息的，就算用户愿意让你知道。用Html也是无法把信息记录到某一个特定文件里的。要把客户端的信息记录在服务器的硬盘上，就要用到CGI。 这是CGI最重要的作用，它补充了Html的不足。是的，仅仅是补充，不是替代。
  
使在网络服务器下运行外部分应用程序 (或网关) 成为可能。CGI-BIN 目录是存放CGI脚本的地方。这些脚本使WWW服务器和浏览器能运行外部程序，而无需启动另一个原因程序。
  
它是运行在Web服务器上的一个程序，并由来自于浏览者的输人触发。CGI是在HTTP服务器下运行外部程序 (或网关) 的一个接口，它能让网络用户访问远程系统上的使用类型程序，就好像他们在实际使用那些远程计算机一样。
  
CGI能够让浏览者与服务器进行交互，如果你曾经遇到过在网络上填表或者进行搜索，就很有可能就是用的CGI。
  
尽管CGI易于使用，但是当大批人同时使用一个CGI应用程序是会反应较慢，网络服务器 速度也会受到很大 影响。CGI应用程序的优点是可以独立运行。
  
CGI应用程序可以由大多数的编程语言编写，如Perl (Practical Extraction and Report Language)、CC++、Java 和Visual Basic等。不过对于那些没有太多编程经验的网页制作人来说，实在是一个不小的难题。
  
CGI应用程序的工作原理: 
  
1.浏览器通过HTML表单或超链接请求指上一个CGI应用程序的URL。
  
2.服务器收发到请求。
  
3.服务器执行指定所CGI应用程序。
  
4.CGI应用程序执行所需要的操作，通常是基于浏览者输入的内容。
  
5.CGI应用程序把结果格式化为网络服务器和浏览器能够理解的文档 (通常是HTML网页) 。
  
6.网络服务器把结果返回到浏览器中。
  
有关CGI应用程序要注意的: 
  
CGI应用程序运行在浏览器可以请求的服务器系统上，执行时需要使用服务器CPU时间和内存。如果有成千上万的这种程序会同时运行，那会对服务器系统提出极高的要求。你要慎重考虑这个问题，以防止服务器系统崩溃。
  
不完善的CGI应用程序可能成为别人非法进人服务器系统的通道，有可能导致重要的资料被删除或外泄。CGI应用程序主要的用途有以下几种: 
  
根据浏览者填写的HTML表单发送定制的答复；
  
创建可单击的图像缩小图；
  
创建一个浏览者可以搜索内容的数据库；
  
提供服务器与数据库的接口，并把结果转换成HTML文档；
  
制作动态HTML文挡。
  
如果一个CGI脚本可以在每台计算机上做同样的事情；编写脚本就会变的很容易。不幸的是，CGI脚本依赖于服务器的操作系统，因此，对于非UNIX服务器来说，Prl (UNIX下编写脚本的一个常用工具) 脚本毫无用处。所以，你必须定制安装你的CGI脚本。
  
大多数服务器都提供CGI-BIN目录，但是这还不够。因为你应该拥有自己的CGI-BIN。这样，你就能运行自己的脚本 (而不是让自己的系统去适应已存在于系统上的脚本) 。因此，你的提供商应安装CGI-BIN，且能够帮助你编写脚本
  
ASP:Active Server Page
  
ASP，活动服务器页面,就是一个编程环境，在其中，可以混合使用HTML、脚本语言以及组件来创建服务器端功能强大的Internet应用程序。 如果你以前创建过一个站点，其中混合了HTML、脚本语言以及组件，你就可以在其中加入ASP程序代码。通过在HTML页面中加入脚本命令，你可以创建一个HTML用户界面，并且，还可以通过使用组件包含一些商业逻辑规则。组件可以被脚本程序调用，也可以由其他的组件调用。
  
ASP的工作原理: 
  
当在Web站点中融入ASP功能后，将发生以下事情: 
  
1. 用户调出站点内容，默认页面的扩展名是.asp。
  
2. 浏览器从服务器上请求ASP文件。
  
3. 服务器端脚本开始运行ASP。
  
4. ASP文件按照从上到下的顺序开始处理，执行脚本命令，执行HTML页面内容。
  
5. 页面信息发送到浏览器。
  
因为脚本是在服务器端运行的，所以Web服务器完成所有处理后，将标准的HTML页面送往浏览器。这意味着，ASP只能在可以支持的服务器上运行。让脚本驻留在服务器端的另外一个益处是: 用户不可能看到原始脚本程序的代码，用户看到的，仅仅是最终产生的HTML内容
  
PHP:Hypertext Preprocessor
  
PHP 是一种服务器端的，嵌入HTML的脚本语言。PHP区别其他像客户端Javascript的地方是它的代码在服务器端执行.PHP能做什么?
  
最低水平,PHP可以做任何其他CGI程序所能做的事,例如收集表格数据,生成动态页面内容,或者收发cookies.可能最强大,最有意义的特性是PHP支持大范围的数据库.书写一个支持数据库的Web 页面是难以置信的简单.
  
下面是当前支持的数据库:
  
Adabas D InterBase Solid
  
dBase mSQL Sybase
  
Empress MySQL Velocis
  
FilePro Oracle Unix dbm
  
Informix PostgreSQL
  
PHP 通过协议也支持与其他服务的"交谈", 像 IMAP, SNMP, NNTP, POP3, 甚至是 HTTP. 你也可以打开晦涩的 网络接口和其他协议交互.
  
## PHP的简要历史
  
1994年秋季, Rasmus Lerdorf 开始构思 PHP. 早期的非发行版本被用在他的主页上,以追踪谁在看他的在线简历. 1995年年初第一版本出台,当时PHP只被认为是个人主页开发工具.它由一个非常单纯的只能理解很少数特殊宏的分析引擎和 一些用在主页后端通用的工具组成.如留言簿,计数器和其他一些东西.这个分析器在1995年年中被重写并被命名为 PHP/FI 第二版. FI来自 Rasmus 写的另外一个包, 用于解释 html 形式的数据.他结合了个人主页工具脚本和形式解析器,并加 上mSQL支持.这样就产生 PHP/FI 了. PHP/FI以令人惊奇的步调成长,人们开始把自己的代码贡献给它.
  
很难给出它的硬统计表,但可以估计在1996年末,整个世界至少有15,000个网站在用PHP/FI.到1997年年中,这个数字已经超过50,000了. 而在此时PHP的发展也发生了变化.由Rasmus自己偏爱的和几个人开发的项目变成一个更有组织的团 体成就.Zeev Suraski和Andi Gutmans重写了解析器.这个新的解析器成为PHP版本3的基础.许多有用的代码从PHP/FI 继承到PHP3,并且很多是完全重写的.
  
今天(1999年年中)不管是PHP/FI或PHP3与很多商业产品捆绑在一块,例如C2级强度的Web服务器和红帽子Linux. 根据NetCraft提供的数据推断,保守估计全世界应用PHP的网站已超过150,000个.由此看来,它比在因特网上运行Netscape 的旗舰企业服务器的站点还多.

###在互联网爆发的初期，CGI为开发互联网应用做出了很大的贡献，但是随着技术的发展，开始逐渐衰落。