---
title: STP
author: "-"
date: 2011-12-04T04:31:39+00:00
url: /?p=1751
categories:
  - Linux
  - Network
tags:
  - reprint
---
## STP
<http://hghhghwh.blog.163.com/blog/static/1338973120118413725683/>

STP (Spanning Tree Protocol) 是生成树协议的英文缩写。

该协议可应用于环路网络，通过一定的算法实现路径冗余，同时将环路网络修剪成无环路的树型网络，从而避免报文在环路网络中的增生和无限循环。

STP定义在 IEEE 802.1D 中，是一种链路管理协议，它为网络提供路径冗余同时防止产生环路。为使以太网更好地工作，两个工作站之间只能有一条活动路径。网络环路的发生有多种原因，最常见的一种是有意生成的冗余 － 万一一个链路或交换机失败，会有另一个链路或交换机替代。

STP的基本原理是，通过在交换机之间传递一种特殊的协议报文 (在IEEE 802.1D中这种协议报文被称为"配置消息") 来确定网络的拓扑结构。配置消息中包含了足够的信息来保证交换机完成生成树计算。

技术原理: 
  
STP的基本思想就是生成"一棵树"，树的根是一个称为根桥的交换机，根据设置不同，不同的交换机会被选为根桥，但任意时刻只能有一个根桥。由根桥开始，逐级形成一棵树，根桥定时发送配置报文，非根桥接收配置报文并转发，如果某台交换机能够从两个以上的端口接收到配置报文，则说明从该交换机到根有不止一条路径，便构成了循环回路，此时交换机根据端口的配置选出一个端口并把其他的端口阻塞，消除循环。当某个端口长时间不能接收到配置报文的时候，交换机认为端口的配置超时，网络拓扑可能已经改变，此时重新计算网络拓扑，重新生成一棵树。
  
2. 功能介绍: 
  
生成树协议最主要的应用是为了避免局域网中的网络环回，解决成环以太网网络的"广播风暴"问题，从某种意义上说是一种网络保护技术，可以消除由于失误或者意外带来的循环连接。STP也提供了为网络提供备份连接的可能，可与SDH保护配合构成以太环网的双重保护。新型以太单板支持符合ITU-T 802.1d标准的生成树协议STP及802.1w规定的快速生成树协议RSTP，收敛速度可达到1s。
  
但是，由于协议机制本身的局限，STP保护速度慢 (即使是1s的收敛速度也无法满足电信级的要求) ，如果在城域网内部运用STP技术，用户网络的动荡会引起运营商网络的动荡。目前在MSTP 组成环网中，由于SDH保护倒换时间比STP协议收敛时间快的多，系统采用依然是SDH MS-SPRING或SNCP，一般倒换时间在50ms以内。但测试时部分以太网业务的倒换时间为0或小于几个毫秒，原因是内部具有较大缓存。SDH保护倒换动作对MAC层是不可见的。这两个层次的保护可以协调工作，设置一定的"拖延时间"(hold-off),一般不会出现多次倒换问题。