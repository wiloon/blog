---
title: 快速匹配字符串
author: lcf
type: post
date: 2012-11-26T09:43:58+00:00
url: /?p=4771
categories:
  - Development
  - Web

---
假设内存有一个大字符串集，里面含有约1000万个字符串，如何快速知道该字符串集是否含有某个指定的测试字符串 ? （假设内存能放下这么多字符串)

方法一：hashCode法

方法二：Trie树 http://zh.wikipedia.org/wiki/Trie
  
    HashCode法
  
  <div id="highlighter_564153">
    
      
        <table>
          <tr>
            <td>
              <code>01</code>
            </td>
            
            <td>
              <code>def</code> <code>sampleHashMap(strSet</code><code>:</code> <code>Set[String])</code><code>:</code> <code>Map[Int, Set[String]]</code><code>=</code><code>{ </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>02</code>
            </td>
            
            <td>
              <code>   </code><code>strSet.groupBy{ </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>03</code>
            </td>
            
            <td>
              <code>      </code><code>s </code><code>=</code><code>> s.hashCode </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>04</code>
            </td>
            
            <td>
              <code>   </code><code>}   </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>05</code>
            </td>
            
            <td>
              <code>} </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>06</code>
            </td>
            
            <td>
              <code> </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>07</code>
            </td>
            
            <td>
              <code>def</code> <code>contain(str</code><code>:</code> <code>String, sampleMap</code><code>:</code> <code>Map[Int, Set[String]])</code><code>:</code> <code>Boolean </code><code>=</code> <code>{  </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>08</code>
            </td>
            
            <td>
              <code>   </code><code>sampleMap.getOrElse(str.hashCode, Set[String]()).exists(</code><code>_</code> <code>equals str) </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>09</code>
            </td>
            
            <td>
              <code>} </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>10</code>
            </td>
            
            <td>
              <code> </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>11</code>
            </td>
            
            <td>
              <code>// 测试 </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>12</code>
            </td>
            
            <td>
              <code>val</code> <code>sampleSet </code><code>=</code> <code>Set(</code><code>"a"</code><code>,</code><code>"b"</code><code>,</code><code>"c"</code><code>,</code><code>"AA"</code><code>,</code><code>"Archer"</code><code>,</code><code>"Jack"</code><code>); </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>13</code>
            </td>
            
            <td>
              <code>val</code> <code>sampleMap </code><code>=</code> <code>sampleHashMap(sampleSet); </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>14</code>
            </td>
            
            <td>
              <code>println(contain(</code><code>"Archer"</code><code>, sampleMap));  </code><code>// true  </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>15</code>
            </td>
            
            <td>
              <code>println(contain(</code><code>"A"</code><code>, sampleMap));    </code><code>//  false </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>16</code>
            </td>
            
            <td>
              <code>println(contain(</code><code>"a"</code><code>, sampleMap));   </code><code>// true</code>
            </td>
          </tr>
        </table>
      
  

  
    <em>[代码]</em> Trie树法
  
  <div id="highlighter_799469">
    
      
        <table>
          <tr>
            <td>
              <code>01</code>
            </td>
            
            <td>
              <code>sealed</code> <code>abstract</code> <code>class</code>  <code>Trie { </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>02</code>
            </td>
            
            <td>
              <code>  </code><code>def</code> <code>contains(msg</code><code>:</code> <code>String)</code><code>:</code> <code>Boolean </code><code>=</code> <code>contains(msg, </code><code>this</code><code>) </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>03</code>
            </td>
            
            <td>
              <code>     </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>04</code>
            </td>
            
            <td>
              <code>   </code><code>@</code><code>scala.annotation.tailrec </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>05</code>
            </td>
            
            <td>
              <code>   </code><code>private</code> <code>def</code> <code>contains(msg</code><code>:</code> <code>String, trie</code><code>:</code> <code>Trie)</code><code>:</code> <code>Boolean </code><code>=</code> <code>(msg, trie) </code><code>match</code> <code>{   </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>06</code>
            </td>
            
            <td>
              <code>        </code><code>case</code> <code>(</code><code>null</code><code>, </code><code>_</code> <code>) | (</code><code>_</code> <code>, </code><code>null</code> <code>) </code><code>=</code><code>> </code><code>false</code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>07</code>
            </td>
            
            <td>
              <code>        </code><code>case</code> <code>(StringCase(head, tail), TrieNode(edges)) </code><code>=</code><code>> edges.get(head) </code><code>match</code> <code>{ </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>08</code>
            </td>
            
            <td>
              <code>            </code><code>case</code> <code>None </code><code>=</code><code>> </code><code>false</code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>09</code>
            </td>
            
            <td>
              <code>            </code><code>case</code> <code>Some(subTrie) </code><code>=</code><code>> contains(tail,subTrie) </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>10</code>
            </td>
            
            <td>
              <code>        </code><code>} </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>11</code>
            </td>
            
            <td>
              <code>        </code><code>case</code> <code>(StringCase(</code><code>_</code><code>,</code><code>_</code><code>), TrieLeaf()) </code><code>=</code><code>> </code><code>false</code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>12</code>
            </td>
            
            <td>
              <code>        </code><code>case</code> <code>_</code> <code>=</code><code>> </code><code>true</code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>13</code>
            </td>
            
            <td>
              <code>    </code><code>} </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>14</code>
            </td>
            
            <td>
              <code>} </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>15</code>
            </td>
            
            <td>
              <code> </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>16</code>
            </td>
            
            <td>
              <code>case</code> <code>class</code> <code>TrieNode(edges</code><code>:</code> <code>Map[Char, Trie]) </code><code>extends</code> <code>Trie{ </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>17</code>
            </td>
            
            <td>
              <code>   </code><code>assert(edges.size > </code><code></code><code>) </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>18</code>
            </td>
            
            <td>
              <code>} </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>19</code>
            </td>
            
            <td>
              <code>case</code> <code>class</code> <code>TrieLeaf </code><code>extends</code> <code>Trie </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>20</code>
            </td>
            
            <td>
              <code> </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>21</code>
            </td>
            
            <td>
              <code>object</code> <code>StringCase{ </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>22</code>
            </td>
            
            <td>
              <code>    </code><code>def</code> <code>unapply(s</code><code>:</code> <code>String)</code><code>:</code> <code>Option[(Char, String)] </code><code>=</code><code>{  </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>23</code>
            </td>
            
            <td>
              <code>      </code><code>if</code> <code>(s </code><code>==</code> <code>null</code> <code>|| s </code><code>==</code> <code>""</code> <code>)  None </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>24</code>
            </td>
            
            <td>
              <code>      </code><code>else</code> <code>Some(s.head, s.tail) </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>25</code>
            </td>
            
            <td>
              <code>    </code><code>} </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>26</code>
            </td>
            
            <td>
              <code>} </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>27</code>
            </td>
            
            <td>
              <code> </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>28</code>
            </td>
            
            <td>
              <code>object</code> <code>Trie{ </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>29</code>
            </td>
            
            <td>
              <code>     </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>30</code>
            </td>
            
            <td>
              <code>   </code><code>def</code> <code>apply(strs</code><code>:</code> <code>String*)</code><code>:</code> <code>Trie </code><code>=</code><code>{ </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>31</code>
            </td>
            
            <td>
              <code>      </code><code>apply(strs.toSet); </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>32</code>
            </td>
            
            <td>
              <code>   </code><code>} </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>33</code>
            </td>
            
            <td>
              <code>    </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>34</code>
            </td>
            
            <td>
              <code>   </code><code>def</code> <code>apply(strSet</code><code>:</code> <code>Set[String]) </code><code>:</code> <code>Trie </code><code>=</code> <code>{ </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>35</code>
            </td>
            
            <td>
              <code>      </code><code>if</code> <code>(strSet.size </code><code>==</code><code></code> <code>|| strSet </code><code>==</code> <code>Set(</code><code>""</code><code>)) TrieLeaf() </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>36</code>
            </td>
            
            <td>
              <code>      </code><code>else</code> <code>{ </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>37</code>
            </td>
            
            <td>
              <code>         </code><code>val</code> <code>char</code><code>2</code><code>TrieSet </code><code>=</code> <code>strSet.filter(</code><code>_</code><code>.length > </code><code></code><code>).groupBy(</code><code>_</code><code>.head).mapValues{ </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>38</code>
            </td>
            
            <td>
              <code>            </code><code>strs </code><code>=</code><code>> strs.map(</code><code>_</code><code>.tail) </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>39</code>
            </td>
            
            <td>
              <code>         </code><code>}.mapValues{ </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>40</code>
            </td>
            
            <td>
              <code>            </code><code>strs </code><code>=</code><code>> apply(strs) </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>41</code>
            </td>
            
            <td>
              <code>         </code><code>} </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>42</code>
            </td>
            
            <td>
              <code>         </code><code>TrieNode(char</code><code>2</code><code>TrieSet); </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>43</code>
            </td>
            
            <td>
              <code>      </code><code>}   </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>44</code>
            </td>
            
            <td>
              <code>   </code><code>} </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>45</code>
            </td>
            
            <td>
              <code>     </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>46</code>
            </td>
            
            <td>
              <code>} </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>47</code>
            </td>
            
            <td>
              <code> </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>48</code>
            </td>
            
            <td>
              <code>val</code> <code>trie</code><code>=</code> <code>Trie(</code><code>"abc"</code><code>,</code><code>"ac"</code><code>,</code><code>"b"</code><code>) </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>49</code>
            </td>
            
            <td>
              <code>println(trie) </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>50</code>
            </td>
            
            <td>
              <code>assert(trie.contains(</code><code>""</code><code>) </code><code>==</code> <code>true</code><code>);     </code><code>// true </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>51</code>
            </td>
            
            <td>
              <code>assert(trie.contains(</code><code>null</code><code>) </code><code>==</code> <code>false</code><code>);   </code><code>//false  </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>52</code>
            </td>
            
            <td>
              <code>assert(trie.contains(</code><code>"a"</code><code>) </code><code>==</code> <code>true</code><code>);    </code><code>// true </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>53</code>
            </td>
            
            <td>
              <code>assert(trie.contains(</code><code>"b"</code><code>) </code><code>==</code> <code>true</code><code>);    </code><code>// true </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>54</code>
            </td>
            
            <td>
              <code>assert(trie.contains(</code><code>"ab"</code><code>) </code><code>==</code> <code>true</code><code>);   </code><code>//true </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>55</code>
            </td>
            
            <td>
              <code>assert(trie.contains(</code><code>"ac"</code><code>) </code><code>==</code> <code>true</code><code>);   </code><code>//true </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>56</code>
            </td>
            
            <td>
              <code>assert(trie.contains(</code><code>"abc"</code><code>) </code><code>==</code> <code>true</code><code>);   </code><code>//true </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>57</code>
            </td>
            
            <td>
              <code>assert(trie.contains(</code><code>"acb"</code><code>) </code><code>==</code> <code>false</code><code>);   </code><code>// false </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>58</code>
            </td>
            
            <td>
              <code>assert(trie.contains(</code><code>"abcd"</code><code>) </code><code>==</code> <code>false</code><code>);   </code><code>//false </code>
            </td>
          </tr>
        </table>
      
      
      
        <table>
          <tr>
            <td>
              <code>59</code>
            </td>
            
            <td>
              <code>assert(trie.contains(</code><code>"bc"</code><code>) </code><code>==</code> <code>false</code><code>);   </code><code>//false</code>
            </td>
          </tr>
        </table>
      
  
