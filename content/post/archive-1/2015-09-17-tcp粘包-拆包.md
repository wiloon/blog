---
title: TCP粘包 拆包
author: wiloon
type: post
date: 2015-09-17T00:02:26+00:00
url: /?p=8273
categories:
  - Uncategorized

---
TCP网络通信时候会发生粘包/拆包的问题，接下来探讨其解决之道。

什么是粘包/拆包

一般所谓的TCP粘包是在一次接收数据不能完全地体现一个完整的消息数据。TCP通讯为何存在粘包呢？主要原因是TCP是以流的方式来处理数据，再加上网络上MTU的往往小于在应用处理的消息数据，所以就会引发一次接收的数据无法满足消息的需要，导致粘包的存在。处理粘包的唯一方法就是制定应用层的数据通讯协议，通过协议来规范现有接收的数据是否满足消息数据的需要。
  
情况分析

TCP粘包通常在流传输中出现，UDP则不会出现粘包，因为UDP有消息边界，发送数据段需要等待缓冲区满了才将数据发送出去，当满的时候有可能不是一条消息而是几条消息合并在换中去内，在成粘包；另外接收数据端没能及时接收缓冲区的包，造成了缓冲区多包合并接收，也是粘包。

解决办法

1、消息定长，报文大小固定长度，不够空格补全，发送和接收方遵循相同的约定，这样即使粘包了通过接收方编程实现获取定长报文也能区分。
  
2、包尾添加特殊分隔符，例如每条报文结束都添加回车换行符（例如FTP协议）或者指定特殊字符作为报文分隔符，接收方通过特殊分隔符切分报文区分。

3、将消息分为消息头和消息体，消息头中包含表示信息的总长度（或者消息体长度）的字段

4、更复杂的自定义应用层协议



http://my.oschina.net/imhoodoo/blog/357290