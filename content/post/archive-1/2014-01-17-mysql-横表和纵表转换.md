---
title: mysql 横表和纵表转换
author: wiloon
type: post
date: 2014-01-17T12:43:57+00:00
url: /?p=6232
categories:
  - Uncategorized
tags:
  - MySQL

---
<div>
  <h2>
  </h2>
</div>

<div id="content">
  <p>
    <strong><span style="text-decoration: underline;">（1）表tb1有如下数据：</span></strong>
  </p>
  
  <p>
    姓名                     语文                        数学                    物理
  </p>
  
  <p>
    张三                       68                           89                        99
  </p>
  
  <p>
    李四                      90                            66                         78
  </p>
  
  <p>
    &nbsp;
  </p>
  
  <p>
    现在要求写出查询语句得到如下查询结果
  </p>
  
  <p>
    name                    subject                       score
  </p>
  
  <p>
    张三                       语文                           68<br /> 张三                       数学                           89<br /> 张三                       物理                            99<br /> 李四                       语文                            90<br /> 李四                      数学                            66<br /> 李四                       物理                            78
  </p>
  
  <p>
    sql语句如下：
  </p>
  
  <p>
    select 姓名 as name,&#8217;语文&#8217; as subject,语文 as score from tb1<br /> union<br /> select 姓名 as name,&#8217;数学&#8217; as subject,数学 as score from tb1<br /> union<br /> select 姓名 as name,&#8217;物理&#8217; as subject,物理 as score from tb1<br /> order by name
  </p>
  
  <p>
    或者：
  </p>
  
  <p>
    select * from(<br /> select 姓名 as name,&#8217;语文&#8217; as subject,语文 as score from tb1<br /> union<br /> select 姓名 as name,&#8217;数学&#8217; as subject,数学 as score from tb1<br /> union<br /> select 姓名 as name,&#8217;物理&#8217; as subject,物理 as score from tb1<br /> )tb<br /> order by name
  </p>
  
  <p>
    （2）tb2表有如下数据：
  </p>
  
  <p>
    name              subject                  score
  </p>
  
  <p>
    张三               语文                       74<br /> 张三                英语                      88<br /> 张三                物理                       90<br /> 李四                语文                      88<br /> 李四                英语                      67<br /> 李四                物理                        95
  </p>
  
  <p>
    &nbsp;
  </p>
  
  <p>
    通过查询得到如下数据：
  </p>
  
  <p>
    姓名         语文                  英语                     物理
  </p>
  
  <p>
    张三          74                   88                        90<br /> 李四           88                    67                        95
  </p>
  
  <p>
    &nbsp;
  </p>
  
  <p>
    sql语句如下：
  </p>
  
  <p>
    select name as &#8216;姓名&#8217;,<br /> max(case subject when &#8216;语文&#8217; then score else 0 end) 语文,<br /> max(case subject when &#8216;英语&#8217; then score else 0 end) 英语,<br /> max(case subject when &#8216;物理&#8217; then score else 0 end)物理<br /> from tb2<br /> group by name
  </p>
  
  <p>
    现在要求写出查询语句得到如下结果：
  </p>
  
  <p>
    姓名         语文                  英语                     物理            总分                平均分
  </p>
  
  <p>
    张三          74                    88                        90               252                    84<br /> 李四           88                    67                        95                250                    83.33
  </p>
  
  <p>
    &nbsp;
  </p>
  
  <p>
    sql:
  </p>
  
  <p>
    select name &#8216;姓名&#8217;,<br /> max(case subject when &#8216;语文&#8217; then result else 0 end) 语文,<br /> max(case subject when &#8216;物理&#8217; then result else 0 end) 物理,<br /> max(case subject when &#8216;英语&#8217; then result else 0 end)英语,<br /> sum(result) as 总分,<br /> avg(result) as 平均分<br /> from tb<br /> group by name
  </p>
</div>