---
title: NAS, raid
author: w1100n
type: post
date: 2015-05-02T00:45:20+00:00
url: /?p=7551
categories:
  - Uncategorized

---
http://www.zhihu.com/question/19786074

NAS - Network Attached Storage： 是一种存储类型，说白了就是主机通过Ethernet网络访问存储数据的一种类型存储。

与之相对的是

SAN （storage area network) storage：主机通过Fibre Channel访问存储数据的一种类型存储

通过Ethernet网络访问存储数据，采用的协议当前有NFS、SMB、iSCS
  
NFS和SMB都是基于文件系统访问的运行在ethernet网络的协议，NFS用于Unix操作系统平台（比如：AIX，HP-UX，各种Linux）的访问协议；SMB协议用于windows系统平台的文件系统访问协议。
  
而iSCSI又称为IP-SAN，是一种基于ethernet网络下的SCSI-3协议，它是基于块设备(block)的数据访问协议。
  
NAS storage支持NFS、SMB、iSCSI协议

更传统的性能更高，但是成本也更高的是基于Fibre Channel的SCSI-3访问协议，它是基于块设备(block)的数据访问协议
  
SAN storage使用基于Fibre Channel的SCSI-3访问协议

NFS是一种网络文件系统，也可以理解为网络文件传输协议。就是定义文件数据如何在网络中传输，通过怎样的协议去访问网络端的文件。

NAS指的是在网络中提供文件服务的设备。

一般的NAS都支持NFS这种协议，当然还会支持CIFS、FTP等多种网络文件传输协议。

## RAID
https://post.smzdm.com/p/a83d9q5n/
### Raid0
RAID 0是最早出现的RAID模式，即Data Stripping数据分条技术。RAID 0是组建磁盘阵列中最简单的一种形式，只需要2块以上的硬盘即可，成本低，可以提高整个磁盘的性能和吞吐量。RAID 0没有提供冗余或错误修复能力，但实现成本是最低的。RAID 0最简单的实现方式就是把N块同样的硬盘用硬件的形式通过智能磁盘控制器或用操作系统中的磁盘驱动程序以软件的方式串联在一起创建一个大的卷集。在使用中电脑数据依次写入到各块硬盘中，它的最大优点就是可以整倍的提高硬盘的容量。如使用了三块80GB的硬盘组建成RAID 0模式，那么磁盘容量就会是240GB。其速度方面，各单独一块硬盘的速度完全相同。最大的缺点在于任何一块硬盘出现故障，整个系统将会受到破坏，可靠性仅为单独一块硬盘的1/N。

为了解决这一问题，便出现了RAID 0的另一种模式。即在N块硬盘上选择合理的带区来创建带区集。其原理就是将原先顺序写入的数据被分散到所有的四块硬盘中同时进行读写。四块硬盘的并行操作使同一时间内磁盘读写的速度提升了4倍。

在创建带区集时，合理的选择带区的大小非常重要。如果带区过大，可能一块磁盘上的带区空间就可以满足大部分的I/O操作，使数据的读写仍然只局限在少数的一、两块硬盘上，不能充分的发挥出并行操作的优势。另一方面，如果带区过小，任何I/O指令都可能引发大量的读写操作，占用过多的控制器总线带宽。因此，在创建带区集时，我们应当根据实际应用的需要，慎重的选择带区的大小。

带区集虽然可以把数据均匀的分配到所有的磁盘上进行读写。但如果我们把所有的硬盘都连接到一个控制器上的话，可能会带来潜在的危害。这是因为当我们频繁进行读写操作时，很容易使控制器或总线的负荷 超载。为了避免出现上述问题，建议用户可以使用多个磁盘控制器。最好解决方法还是为每一块硬盘都配备一个专门的磁盘控制器。虽然RAID 0可以提供更多的空间和更好的性能，但是整个系统是非常不可靠的，如果出现故障，无法进行任何补救。所以，RAID 0一般只是在那些对数据安全性要求不高的情况下才被人们使用。


### RAID1
RAID1是将一个两块硬盘所构成RAID磁盘阵列，其容量仅等于一块硬盘的容量，因为另一块只是当作数据“镜像”。RAID 1磁盘阵列显然是最可靠的一种阵列，因为它总是保持一份完整的数据备份。它的性能自然没有RAID 0磁盘阵列那样好，但其数据读取确实较单一硬盘来的快，因为数据会从两块硬盘中较快的一块中读出。RAID 1磁盘阵列的写入速度通常较慢，因为数据得分别写入两块硬盘中并做比较。RAID 1磁盘阵列一般支持“热交换”，就是说阵列中硬盘的移除或替换可以在系统运行时进行，无须中断退出系统。RAID 1磁盘阵列是十分安全的，不过也是较贵一种RAID磁盘阵列解决方案，因为两块硬盘仅能提供一块硬盘的容量。RAID 1磁盘阵列主要用在数据安全性很高，而且要求能够快速恢复被破坏的数据的场合。

###  RAID 5
RAID 5 是一种存储性能、数据安全和存储成本兼顾的存储解决方案。 RAID 5可以理解为是RAID 0和RAID 1的折中方案。RAID 5可以为系统提供数据安全保障，但保障程度要比Mirror低而磁盘空间利用率要比Mirror高。RAID 5具有和RAID 0相近似的数据读取速度，只是多了一个奇偶校验信息，写入数据的速度比对单个磁盘进行写入操作稍慢。同时由于多个数据对应一个奇偶校验信息，RAID 5的磁盘空间利用率要比RAID 1高，存储成本相对较低，是目前运用较多的一种解决方案。
一句话介绍：至少需要三个硬盘，提供容错保护功能并提高了读取性能。RAID 5 可在单个硬盘丢失时得以维持运行。

### RAID6
1、 RAID 6磁盘阵列由N (N>=4)块盘组成阵列, 存储容量为N块磁盘容量总和的（N-2) /N。
2、 RAID 6技术是在RAID 5基础上，为了进一步加强数据保护而设计的一种RAID方式，实际上是一种扩展RAID 5等级。与RAID 5的不同之处于除了每个硬盘上都有同级数据XOR校验区外，还有一个针对每个数据块的XOR校验区。当然，当前盘数据块的校验数据不可能存在当前盘而是交错存储的，具体形式见图。
3、 RAID 6每个数据块有两个校验保护屏障（一个分层校验，一个是总体校验），因此RAID 6的数据冗余性能相当好。即使同时损失两块磁盘也不会影响数据使用，但是由于增加了一个校验，所以写入的效率较RAID 5还差，而且控制系统的设计也更为复杂，第二块的校验区也减少了有效存储空间。


### RAID10
RAID10也被称为镜象阵列条带。象RAID0一样，数据跨磁盘抽取；象RAID1一样，每个磁盘都有一个镜象磁盘, 所以RAID 10的另一种会说法是 RAID 0+1。RAID10提供100%的数据冗余，支持更大的卷尺寸，但价格也相对较高。对大多数只要求具有冗余度而不必考虑价格的应用来说，RAID10提供最好的性能。使用RAID10，可以获得更好的可靠性，因为即使两个物理驱动器发生故障（每个阵列中一个），数据仍然可以得到保护。RAID10需要4 + 2*N 个磁盘驱动器（N >=0)， 而且只能使用其中一半(或更小, 如果磁盘大小不一)的磁盘用量, 例如 4 个 250G 的硬盘使用RAID10 阵列， 实际容量是 500G。

实现原理：

Raid10其实结构非常简单，首先创建2个独立的Raid1，然后将这两个独立的Raid1组成一个Raid0，当往这个逻辑Raid中写数据时，数据被有序的写入两个Raid1中。磁盘1和磁盘2组成一个Raid1，磁盘3和磁盘4又组成另外一个Raid1;这两个Raid1组成了一个新的Raid0。如写在硬盘1上的数据1、3、5、7，写在硬盘2中则为数据1、3、5、7，硬盘中的数据为0、2、4、6，硬盘4中的数据则为0、2、4、6，因此数据在这四个硬盘上组合成Raid10，且具有raid0和raid1两者的特性。
虽然Raid10方案造成了50%的磁盘浪费，但是它提供了200%的速度和单磁盘损坏的数据安全性，并且当同时损坏的磁盘不在同一Raid1中，就能保证数据安全性。假如磁盘中的某一块盘坏了，整个逻辑磁盘仍能正常工作的。
当我们需要恢复RAID10中损坏的磁盘时，只需要更换新的硬盘，按照RAID10的工作原理来进行数据恢复，恢复数据过程中系统仍能正常工作。原先的数据会同步恢复到更换的硬盘中。
总结：

磁盘空间利用率：50%。

读性能：N/2*单块硬盘的读性能

写性能：N/2*单块硬盘的写性能

冗余：只要一对镜像盘中有一块磁盘可以使用就没问题。

### 群晖 SHR
Synology Hybrid RAID (SHR) 是 Synology 的自动 RAID 管理系统，经专门设计，可快速和方便地部署存储卷。它可使存储卷部署比传统的 RAID 系统更加轻松。SHR 可让用户进行 RAID 管理、扩充存储器、使存储容量最大化，即便它们没有很好掌握各种 RAID 级别。SHR 允许 1 块或 2 块硬盘冗余 - 这意味着 SHR 卷能够经受住最多 2 块硬盘发生故障而数据卷仍可使用。请注意，一个 RAID 卷（传统 RAID 或 SHR）不是备份系统。SHR 基于 Linux RAID 管理系统，且使用时完全可选。在寻求存储数据保护方面，SHR 不仅使传统 RAID 系统的专家用户受益，也能使没有太多技术背景的新手用户受益。
