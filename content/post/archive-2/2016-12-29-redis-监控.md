---
title: redis 监控
author: wiloon
type: post
date: 2016-12-29T00:06:42+00:00
url: /?p=9631
categories:
  - Uncategorized

---
http://www.jianshu.com/p/68485d5c7fb9


Redis Server监控数据采集
  
ping,info all, slowlog get/len/reset/cluster info/config get
  
Redis存活监控
  
redis存活监控 (redis_alive):redis本地监控agent使用ping，如果指定时间返回PONG表示存活，否则redis不能响应请求，可能阻塞或死亡。当返回值不为1时，redis挂了，告警
  
[root@tzgdevapp10 bin]# ./redis-cli -c -p 7000 ping | grep -c PONG
  
连接个数 (connected_clients)：客户端连接个数，如果连接数过高，影响redis吞吐量。>5000 时告警
  
[root@tzgdevapp10 bin]# ./redis-cli -c -p 7000 info | grep -w "connected_clients" | awk -F":" '{print $2}'
  
连接数使用率(connected\_clients\_pct): 连接数使用百分比，通过(connected_clients/maxclients)计算；如果达到1，redis开始拒绝新连接创建，告警
  
拒绝的连接个数(rejected_connections): redis连接个数达到maxclients限制，拒绝新连接的个数。告警
  
[root@tzgdevapp10 bin]# ./redis-cli -c -p 7000 info | grep -w rejected_connections
  
rejected_connections:0
  
新创建连接个数 (total\_connections\_received): 如果新创建连接过多，过度地创建和销毁连接对性能有影响，说明短连接严重或连接池使用有问题，告警。
  
[root@tzgdevapp10 bin]# ./redis-cli -c -p 7000 info | grep -w total\_connections\_received
  
total\_connections\_received:217
  
list阻塞调用被阻塞的连接个数 (blocked_clients): 如果监控数据大于0，告警
  
[root@tzgdevapp10 bin]# ./redis-cli -c -p 7000 info | grep -w blocked_clients
  
blocked_clients:0
  
redis分配的内存大小 (used_memory): redis真实使用内存，不包含内存碎片
  
[root@tzgdevapp10 bin]# ./redis-cli -c -p 7000 info | grep -w used_memory
  
used_memory:2513656
  
redis进程使用内存大小(used\_memory\_rss): 进程实际使用的物理内存大小，包含内存碎片；如果rss过大导致内部碎片大，内存资源浪费，和fork的耗时和cow内存都会增大。
  
[root@tzgdevapp10 bin]# ./redis-cli -c -p 7000 info | grep -w used\_memory\_rss
  
used\_memory\_rss:9728000
  
redis内存碎片率 (mem\_fragmentation\_ratio): 表示(used\_memory\_rss/used_memory)，碎片率过大，导致内存资源浪费，不设置告警。小于1，表示redis已使用swap分区，则告警
  
[root@tzgdevapp10 bin]# ./redis-cli -c -p 7000 info | grep -w mem\_fragmentation\_ratio
  
mem\_fragmentation\_ratio:3.89
  
键个数 (keys): redis实例包含的键个数。单实例键个数过大，可能导致过期键的回收不及时。
  
[root@tzgdevapp10 bin]# ./redis-cli -c -p 7000 info | grep -w keys | awk -F':' '{print $2}' | awk -F',' '{print $1}' | awk -F'=' '{print $2}'
  
redis处理的命令数 (total\_commands\_processed): 监控采集周期内的平均qps
  
./redis-cli -c -p 7000 info | grep -w total\_commands\_processed| awk -F':' '{print $2}'
  
redis当前的qps (instantaneous\_ops\_per_sec): redis内部较实时的每秒执行的命令数
  
./redis-cli -c -p 7000 info | grep -w instantaneous\_ops\_per_sec | awk -F':' '{print $2}'
  
请求键被命中次数 (keyspace_hits): redis请求键被命中的次数
  
[root@tzgdevapp10 bin]# ./redis-cli -c -p 7000 info | grep -w keyspace_hits | awk -F':' '{print $2}'
  
请求键未被命中次数 (keyspace_misses): redis请求键未被命中的次数
  
[root@tzgdevapp10 bin]# ./redis-cli -c -p 7000 info | grep -w keyspace_misses
  
keyspace_misses:122
  
请求键的命中率 (keyspace\_hit\_ratio):使用keyspace\_hits/(keyspace\_hits+keyspace_misses)计算所得，命中率低于50%告警
  
最近一次fork阻塞的微秒数 (latest\_fork\_usec): 最近一次Fork操作阻塞redis进程的耗时数，单位微秒。
  
[root@tzgdevapp10 bin]# ./redis-cli -c -p 7000 info | grep -w latest\_fork\_usec
  
latest\_fork\_usec:315
  
三、Redis集群监控
  
cluster info 、info
  
实例是否启用集群模式 (cluster\_enabled): 通过info的cluster\_enabled监控是否启用集群模式。不等于1则告警
  
[root@tzgdevapp10 bin]# ./redis-cli -c -p 7000 info | grep -w cluster_enabled
  
cluster_enabled:1
  
集群健康状态 （clusster\_state):cluster\_state不为OK则告警
  
[root@tzgdevapp10 bin]# ./redis-cli -c -p 7000 cluster info
  
cluster_state:ok
  
集群数据槽slots分配情况 (cluster\_slots\_assigned):集群正常运行时，默认16384个slots
  
不等于16384则告警[root@tzgdevapp10 bin]# ./redis-cli -c -p 7000 cluster info | grep -w cluster\_slots\_ok
  
cluster\_slots\_ok:16384
  
检测下线的数据槽slots个数 (cluster\_slots\_fail):集群正常运行时，应该为0. 如果大于0说明集群有slot存在故障。
  
[root@tzgdevapp10 bin]# ./redis-cli -c -p 7000 cluster info | grep -w cluster\_slots\_fail
  
cluster\_slots\_fail:0
  
集群的节点数 （cluster\_known\_nodes）：集群中redis节点的个数
  
[root@tzgdevapp10 bin]# ./redis-cli -c -p 7000 cluster info | grep -w cluster\_known\_nodes
  
cluster\_known\_nodes:6
  
文／疲马羁禽（简书作者）
  
原文链接：http://www.jianshu.com/p/68485d5c7fb9
  
著作权归作者所有，转载请联系作者获得授权，并标注"简书作者"。