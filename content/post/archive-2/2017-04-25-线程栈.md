---
title: 线程栈
author: w1100n
type: post
date: 2017-04-25T08:47:22+00:00
url: /?p=10152
categories:
  - Uncategorized

---
先从操作系统的角度来复习下基础知识，进程是操作系统进行资源分配的基本单位，线程是CPU进行调度和分派的基本单位。我们通常意义下的进程包括：由二进制代码组成的应用程序、单线程、分配给该应用程序的一组资源（如内存、文件等）
  
wikipedia上叫callstack调用栈，并不是孤立的有进程栈这个说法，进程只是在分配时通过如随机化方式指定了栈底的初始地址，进程的子线程们有各自的私有栈，可以共享父进程分配的堆内存空间，只有一个主线程的进程也就是有主线程对应的栈，所以栈这个说法通常只有线程栈，并没有明确的进程栈之说，那就更没有所谓的进程栈大小了。
  
线程栈：
  
线程包含了表示进程内执行环境必需的信息，其中包括进程中标示线程的线程ID，一组寄存器值，栈，调度优先级和策略， 信号屏蔽字，errno变量以及线程私有数据。进程的所有信息对该进程的所有线程都是共享的，包括可执行的程序文本，程序的全局内存和堆内存，栈以及文件描述符.
  
线程栈起始于进程虚拟 内存的高端地址，并向虚拟内存底端地址方向扩展。取决于线程本身的大小以及其它线程内存分配的情况，进程虚拟地址空间消耗过快可能导致创建线程失败。

我们通常使用ulimit -s可以看到"进程对应栈"的大小（现代linux系统下通常是8MB大小），不论在只有一个主线程的进程中，还是包含许多子线程的进程，都是指线程栈大小，默认8MB，
  
线程栈的空间开辟在所属进程的堆区，线程与其所属的进程共享进程的用户空间，所以线程栈之间可以互访。

通过/proc/PID/task来看该程序有多少线程在运行
  
进程的地址空间 /proc/PID/maps

for java

不显式设置-Xss或-XX:ThreadStackSize时，在Linux x64上ThreadStackSize的默认值就是1024KB，给Java线程创建栈会用这个参数指定的大小。这是前一块代码的意思。如果把-Xss或者-XX:ThreadStackSize设为0，就是使用"系统默认值"。而在Linux x64上HotSpot VM给Java栈定义的"系统默认"大小也是1MB。所以这个条件下普通Java线程的默认栈大小怎样都是1MB。至于操作系统栈大小（ulimit -s）：这个配置只影响进程的初始线程；后续用pthread_create创建的线程都可以指定栈大小。HotSpot VM为了能精确控制Java线程的栈大小，特意不使用进程的初始线程（primordial thread）作为Java线程。

作者：RednaxelaFX
  
链接：https://www.zhihu.com/question/27844575/answer/38370294
  
来源：知乎
  
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。

http://laoar.net/blogs/250/
  
http://blog.csdn.net/daniel_ice/article/details/8146003
  
http://blog.csdn.net/yjzl1911/article/details/5629537

<blockquote data-secret="iaqm21dSlH" class="wp-embedded-content">
  
    <a href="http://www.pandademo.com/2015/10/linux-process-and-thread-stack-size/">Linux 进程栈与线程栈大小</a>
  
</blockquote>

<iframe class="wp-embedded-content" sandbox="allow-scripts" security="restricted" style="position: absolute; clip: rect(1px, 1px, 1px, 1px);" src="http://www.pandademo.com/2015/10/linux-process-and-thread-stack-size/embed/#?secret=iaqm21dSlH" data-secret="iaqm21dSlH" width="600" height="338" title="《Linux 进程栈与线程栈大小》—PandaDemo" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"></iframe>

https://www.zhihu.com/question/27844575