---
title: Oracle杀死死锁进程
author: lcf
type: post
date: 2012-10-24T03:17:56+00:00
url: /?p=4525
categories:
  - DataBase

---
**Oracle杀死死锁进程**

先查看哪些表被锁住了:

&nbsp;

<center>
  </p> 
  
  <table width="400" border="1" cellspacing="0" cellpadding="2" align="center">
    <tr>
      <td bgcolor="#e6e6e6">
        <pre>select b.owner,b.object_name,a.session_id,a.locked_mode
from v$locked_object a,dba_objects b
where b.object_id = a.object_id;

OWNER     OBJECT_NAME     SESSION_ID LOCKED_MODE
------------------------------ -----------------
WSSB SBDA_PSHPFTDT   22 3
WSSB_RTREPOS WB_RT_SERVICE_QUEUE_TAB   24 2
WSSB_RTREPOS WB_RT_NOTIFY_QUEUE_TAB   29 2
WSSB_RTREPOS WB_RT_NOTIFY_QUEUE_TAB   39 2
WSSB SBDA_PSDBDT     47 3
WSSB_RTREPOS WB_RT_AUDIT_DETAIL     47 3

select b.username,b.sid,b.serial#,logon_time
from v$locked_object a,v$session b
where a.session_id = b.sid order by b.logon_time;

USERNAME   SID   SERIAL# LOGON_TIME
------------------------------ ---------- -------
WSSB_RTACCESS     39     1178 2006-5-22 1
WSSB_RTACCESS     29     5497 2006-5-22 1</pre>
      </td>
    </tr>
  </table>
  
  <p>
    </center>杀进程中的会话:
  </p>
  
  <p>
    &nbsp;
  </p>
  
  <p>
    <center>
      </p> 
      
      <table width="400" border="1" cellspacing="0" cellpadding="2" align="center">
        <tr>
          <td bgcolor="#e6e6e6">
            <pre>alter system kill session 'sid,serial#';
e.g
alter system kill session '29,5497';</pre>
          </td>
        </tr>
      </table>
      
      <p>
        </center>如果有ora-00031错误，则在后面加immediate;alter system kill session &#8216;29,5497&#8217; immediate；
      </p>
      
      <p>
        <strong>如何杀死oracle死锁进程</strong>
      </p>
      
      <p>
        １.查哪个过程被锁:
      </p>
      
      <p>
        查V$DB_OBJECT_CACHE视图:
      </p>
      
      <p>
        SELECT * FROM V$DB_OBJECT_CACHE WHERE OWNER=&#8217;过程的所属用户&#8217; AND CLOCKS!=&#8217;0&#8242;;
      </p>
      
      <p>
        2. 查是哪一个SID,通过SID可知道是哪个SESSION:
      </p>
      
      <p>
        查V$ACCESS视图:
      </p>
      
      <p>
        SELECT * FROM V$ACCESS WHERE OWNER=&#8217;过程的所属用户&#8217; AND NAME=&#8217;刚才查到的过程名&#8217;;
      </p>
      
      <p>
        3. 查出SID和SERIAL#：
      </p>
      
      <p>
        查V$SESSION视图:
      </p>
      
      <p>
        SELECT SID,SERIAL#,PADDR FROM V$SESSION WHERE SID=&#8217;刚才查到的SID&#8217;;
      </p>
      
      <p>
        查V$PROCESS视图:
      </p>
      
      <p>
        SELECT SPID FROM V$PROCESS WHERE ADDR=&#8217;刚才查到的PADDR&#8217;;
      </p>
      
      <p>
        4. 杀进程：
      </p>
      
      <p>
        (1)先杀ORACLE进程:
      </p>
      
      <p>
        ALTER SYSTEM KILL SESSION &#8216;查出的SID,查出的SERIAL#&#8217;;
      </p>
      
      <p>
        (2)再杀操作系统进程:
      </p>
      
      <p>
        KILL -9 刚才查出的SPID或ORAKILL 刚才查出的SID 刚才查出的SPID。
      </p>
      
      <p>
        <strong>Oracle的死锁</strong>
      </p>
      
      <p>
        查询数据库死锁：
      </p>
      
      <p>
        &nbsp;
      </p>
      
      <p>
        <center>
          </p> 
          
          <table width="400" border="1" cellspacing="0" cellpadding="2" align="center">
            <tr>
              <td bgcolor="#e6e6e6">
                <pre>select t2.username||'   '||t2.sid||'
 '||t2.serial#||'   '||t2.logon_time||'
 '||t3.sql_text
from v$locked_object t1,v$session t2,v$sqltext t3
where t1.session_id=t2.sid
and t2.sql_address=t3.address
order by t2.logon_time;</pre>
              </td>
            </tr>
          </table>
          
          <p>
            </center>查询出来的结果就是有死锁的session了，下面就是杀掉，拿到上面查询出来的SID和SERIAL#，填入到下面的语句中：
          </p>
          
          <p>
            alter system kill session &#8216;sid,serial#&#8217;;
          </p>
          
          <p>
            一般情况可以解决数据库存在的死锁了，或通过session id 查到对应的操作系统进程，在Unix中杀掉操作系统的进程。
          </p>
          
          <p>
            &nbsp;
          </p>
          
          <p>
            <center>
              </p> 
              
              <table width="400" border="1" cellspacing="0" cellpadding="2" align="center">
                <tr>
                  <td bgcolor="#e6e6e6">
                    <pre>SELECT a.username,c.spid AS os_process_id,c.pid
AS oracle_process_id FROM v$session a,v$process c
WHERE c.addr=a.paddr and a.sid= and a.serial#= ;</pre>
                  </td>
                </tr>
              </table>
              
              <p>
                </center>然后采用kill （unix） 或 orakill（windows ）。
              </p>
              
              <p>
                在Unix中：
              </p>
              
              <p>
                &nbsp;
              </p>
              
              <p>
                <center>
                  </p> 
                  
                  <table width="400" border="1" cellspacing="0" cellpadding="2" align="center">
                    <tr>
                      <td bgcolor="#e6e6e6">
                        <pre>ps -ef|grep os_process_id
kill -9 os_process_id
ps -ef|grep os_process_id</pre>
                      </td>
                    </tr>
                  </table>
                  
                  <p>
                    </center>经常在Oracle的使用过程中碰到这个问题，所以也总结了一点解决方法。
                  </p>
                  
                  <p>
                    1）查找死锁的进程：
                  </p>
                  
                  <p>
                    &nbsp;
                  </p>
                  
                  <p>
                    <center>
                      </p> 
                      
                      <table width="400" border="1" cellspacing="0" cellpadding="2" align="center">
                        <tr>
                          <td bgcolor="#e6e6e6">
                            <pre>sqlplus "/as sysdba"   (sys/change_on_install)
SELECT s.username,l.OBJECT_ID,l.SESSION_ID,s.SERIAL#,
l.ORACLE_USERNAME,l.OS_USER_NAME,l.PROCESS
FROM V$LOCKED_OBJECT l,V$SESSION S WHERE l.SESSION_ID=S.SID;</pre>
                          </td>
                        </tr>
                      </table>
                      
                      <p>
                        </center>2）kill掉这个死锁的进程：
                      </p>
                      
                      <p>
                        alter system kill session ‘sid,serial#’; （其中sid=l.session_id）
                      </p>
                      
                      <p>
                        3）如果还不能解决：
                      </p>
                      
                      <p>
                        &nbsp;
                      </p>
                      
                      <p>
                        <center>
                          </p> 
                          
                          <table width="400" border="1" cellspacing="0" cellpadding="2" align="center">
                            <tr>
                              <td bgcolor="#e6e6e6">
                                <pre>select pro.spid from v$session ses,
v$process pro where ses.sid=XX and
ses.paddr=pro.addr;</pre>
                              </td>
                            </tr>
                          </table>
                          
                          <p>
                            </center>其中sid用死锁的sid替换:
                          </p>
                          
                          <p>
                            &nbsp;
                          </p>
                          
                          <p>
                            <center>
                              </p> 
                              
                              <table width="400" border="1" cellspacing="0" cellpadding="2" align="center">
                                <tr>
                                  <td bgcolor="#e6e6e6">
                                    <pre>exit
ps -ef|grep spid</pre>
                                  </td>
                                </tr>
                              </table>
                              
                              <p>
                                </center>其中spid是这个进程的进程号，kill掉这个Oracle进程。（T006）
                              </p>