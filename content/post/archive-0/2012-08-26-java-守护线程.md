---
title: Java 守护线程 Daemon
author: wiloon
type: post
date: 2012-08-26T03:55:12+00:00
url: /?p=3944
categories:
  - Java

---
JVM中存在两种线程：用户线程 (User Thread)、守护线程 (Daemon Thread)
  
所谓的守护线程，是指用户程序在运行的时候后台提供的一种通用服务的线程，比如用于垃圾回收线程
  
这类线程并不是用户线程不可或缺的部分，只是用于提供服务的”服务线程”。

守护线程与普通线程写法上基本么啥区别，调用线程对象的方法setDaemon(true)，则可以将其设置为守护线程。
  
守护线程使用的情况较少，但并非无用，举例来说，JVM的垃圾回收、内存管理等线程都是守护线程。还有就是在做数据库应用时候，使用的数据库连接池，连接池本身也包含着很多后台线程，监控连接个数、超时时间、状态等等。

当正在运行的线程都是守护线程时，Java 虚拟机退出。

setDaemon()方法必须在启动线程前调用。该方法首先调用该线程的 checkAccess 方法，且不带任何参数。这可能抛出 SecurityException（在当前线程中）。
  
参数：
  
on – 如果为 true，则将该线程标记为守护线程。
  
抛出：
  
IllegalThreadStateException – 如果该线程处于活动状态。
  
SecurityException – 如果当前线程无法修改该线程。
  
另请参见：
  
isDaemon(), checkAccess()

[code lang=java]
  

import java.util.concurrent.TimeUnit;

public class DaemonThread {
      
public static void main(String[] args) {
          
Thread t1 = new MyCommon();
          
Thread t2 = new Thread(new MyDaemon());
          
t2.setDaemon(true); // set as daemon thread

t2.start();
          
t1.start();
      
}

static class MyCommon extends Thread {
          
public void run() {
              
for (int i = 0; i < 5; i++) {
                  
System.out.println("common thread:" + i);
                  
try {
                      
TimeUnit.SECONDS.sleep(3);
                  
} catch (InterruptedException e) {
                      
e.printStackTrace();
                  
}
              
}
          
}
      
}

static class MyDaemon implements Runnable {
          
public void run() {
              
for (int i = 0; i < Integer.MAX_VALUE; i++) {
                  
System.out.println("daemon thread:" + i);
                  
try {
                      
TimeUnit.SECONDS.sleep(3);
                  
} catch (InterruptedException e) {
                      
e.printStackTrace();
                  
}
              
}
          
}
      
}
  
}

```

http://baike.baidu.com/view/407213.htm

http://topic.csdn.net/t/20060115/00/4517316.html

http://lavasoft.blog.51cto.com/62575/221845/

http://blog.csdn.net/lcore/article/details/12280027