---
title: 事务, ACID
author: "-"
type: post
date: 2012-06-28T04:34:12+00:00
url: /?p=3682
categories:
  - Uncategorized

---
### 事务
事务是应用程序中一系列严密的操作，所有操作必须成功完成，否则在每个操作中所作的所有更改都会被撤消。也就是事务具有原子性，一个事务中的一系列的操作要么全部成功，要么一个都不做。事务应该具有 4 个属性：原子性、一致性、隔离性、持久性。这四个属性通常称为 ACID 特性。

### 分布式事务
分布式事务是指事务的参与者、支持事务的服务器、资源服务器以及事务管理器分别位于不同的分布式系统的不同节点之上。例如在大型电商系统中，下单接口通常会扣减库存、减去优惠、生成订单 id, 而订单服务与库存、优惠、订单 id 都是不同的服务，下单接口的成功与否，不仅取决于本地的 db 操作，而且依赖第三方系统的结果，这时候分布式事务就保证这些操作要么全部成功，要么全部失败。本质上来说，分布式事务就是为了保证不同数据库的数据一致性。

### 强一致性
任何一次读都能读到某个数据的最近一次写的数据。系统中的所有进程，看到的操作顺序，都和全局时钟下的顺序一致。简言之，在任意时刻，所有节点中的数据是一样的。

### 弱一致性
数据更新后，如果能容忍后续的访问只能访问到部分或者全部访问不到，则是弱一致性。

### 最终一致性
不保证在任意时刻任意节点上的同一份数据都是相同的，但是随着时间的迁移，不同节点上的同一份数据总是在向趋同的方向变化。简单说，就是在一段时间后，节点间的数据会最终达到一致状态。

ACID，指数据库事务正确执行的四个基本要素的缩写
 
        ACID特性（原子性、一致性、隔离性、持久性）
      
      
      <p class="para">
        <p class="para">
          原子性（Atomicity）
        
        
        <p class="para">
          整个事务中的所有操作，要么全部完成，要么全部不完成，不可能停滞在中间某个环节。事务在执行过程中发生错误，会被回滚（Rollback）到事务开始前的状态，就像这个事务从来没有执行过一样。
        
        
        <p class="para">
          <p class="para">
            一致性（Consistency）
          
          
          <p class="para">
            在事务开始之前和事务结束以后，数据库的完整性约束没有被破坏。
          
          
          <p class="para">
            <p class="para">
              隔离性（Isolation）
            
            
            <p class="para">
              隔离状态执行事务，使它们好像是系统在给定时间内执行的唯一操作。如果有两个事务，运行在相同的时间内，执行相同的功能，事务的隔离性将确保每一事务在系统中认为只有该事务在使用系统。这种属性有时称为串行化，为了防止事务操作间的混淆，必须串行化或序列化请求，使得在同一时间仅有一个请求用于同一数据。
            
            
            <p class="para">
              <p class="para">
                持久性（Durability）
              
              
              <div class="para">
                在事务完成以后，该事务所对数据库所作的更改便持久的保存在数据库之中，并不会被回滚。
              
              
              <div class="para">
                由于一项操作通常会包含许多子操作，而这些子操作可能会因为硬件的损坏或其他因素产生问题，要正确实现ACID并不容易。ACID建议数据库将所有需要更新以及修改的资料一次操作完毕，但实际上并不可行。
              
              
              <div class="para">
                目前主要有两种方式实现ACID：第一种是Write ahead logging，也就是日志式的方式。第二种是Shadow paging。
              
              
              <div class="para">
              
              
              <p class="para">
                一个支持事务（Transaction）的，必需要具有这四种特性，否则在事务过程（Transaction processing）当中无法保证数据的正确性，交易过程极可能达不到交易方的要求。
                
---

>https://xiaomi-info.github.io/2020/01/02/distributed-transaction/
