---
title: debian 网络配置
author: wiloon
type: post
date: 2011-12-03T14:06:17+00:00
url: /?p=1718
bot_views:
  - 1
categories:
  - Linux
  - Network

---
/etc/network/interfaces

[shell]
  
#wlan
  
auto wlan0
  
iface wlan0 inet dhcp
        
wpa-ssid "xxxx"
        
wpa-psk "xxxx"
  
[/shell]
  
话说Debian系的网卡配置跟Redhat系很不一样，Redhat是放在/etc/sysconfig/network-scripts目录下 面的一大堆文件里面，要修改？你一个一个文件来过吧。Debian系的则是存在/etc/network/interfaces文件里面，无论有多少块网 卡，统统扔在这个文件里。下面就来看一下这个文件的内容。

首先，一个基本的配置大概是下面这个样子：

> <span style="color: #804040;"> 1 </span>auto lo
<span style="color: #804040;"> 2 </span>iface lo inet loopback
<span style="color: #804040;"> 3 </span>
<span style="color: #804040;"> 4 </span><span style="color: #0000ff;"># The primary network interface</span>
<span style="color: #804040;"> 5 </span>auto eth0
<span style="color: #804040;"> 6 </span>iface eth0 inet static
<span style="color: #804040;"> 7 </span>     address <span style="color: #ff00ff;">192.168.0.42</span>
<span style="color: #804040;"> 8 </span>     network <span style="color: #ff00ff;">192.168.0.0</span>
<span style="color: #804040;"> 9 </span>     netmask <span style="color: #ff00ff;">255.255.255.0</span>
<span style="color: #804040;"> 10 </span>     broadcast <span style="color: #ff00ff;">192.168.0.255</span>
<span style="color: #804040;"> 11 </span>     gateway <span style="color: #ff00ff;">192.168.0.1</span>

上面的配置中，

第1行跟第5行说明lo接口跟eth0接口会在系统启动时被自动配置；

第2行将lo接口设置为一个本地回环（loopback）地址；

第6行指出eth0接口具有一个静态的（static）IP配置；

第7行-第11行分别设置eth0接口的ip、网络号、掩码、广播地址和网关。

再来看一个更复杂点的：

> <span style="color: #804040;"> 12 </span>auto eth0
<span style="color: #804040;"> 13 </span>iface eth0 inet static
<span style="color: #804040;"> 14 </span>    address <span style="color: #ff00ff;">192.168.1.42</span>
<span style="color: #804040;"> 15 </span>    network <span style="color: #ff00ff;">192.168.1.0</span>
<span style="color: #804040;"> 17 </span>    netmask <span style="color: #ff00ff;">255.255.255.128</span>
<span style="color: #804040;"> 18 </span>    broadcast <span style="color: #ff00ff;">192.168.1.0</span>
<span style="color: #804040;"> 19 </span>    up route add -net <span style="color: #ff00ff;">192.168.1.128</span> netmask <span style="color: #ff00ff;">255.255.255.128</span> gw <span style="color: #ff00ff;">192.168.1.2</span>
<span style="color: #804040;"> 20 </span>    up route add default gw <span style="color: #ff00ff;">192.168.1.200</span>
<span style="color: #804040;"> 21 </span>    down route del default gw <span style="color: #ff00ff;">192.168.1.200</span>
<span style="color: #804040;"> 22 </span>    down route del -net <span style="color: #ff00ff;">192.168.1.128</span> netmask <span style="color: #ff00ff;">255.255.255.128</span> gw <span style="color: #ff00ff;">192.168.1.2</span>

这次，有了一个复杂一些的掩码，和一个比较奇怪的广播地址。还有就是增加的接口启用、禁用时的路由设置；

第19行和20行配置的左右是在接口启用的时候，添加一条静态路由和一个缺省路由；

第21行和22行会在接口禁用的时候，删掉这两条路由配置。

至于配置路由的写法，仔细看，它就是route命令嘛。

继续，下面是一个物理网卡上多个接口的配置方法：

> <span style="color: #804040;"> 23 </span>auto eth0 eth0:1
<span style="color: #804040;"> 24 </span>iface eth0 inet static
<span style="color: #804040;"> 25 </span>    address <span style="color: #ff00ff;">192.168.0.100</span>
<span style="color: #804040;"> 26 </span>    network <span style="color: #ff00ff;">192.168.0.0</span>
<span style="color: #804040;"> 27 </span>    netmask <span style="color: #ff00ff;">255.255.255.0</span>
<span style="color: #804040;"> 28 </span>    broadcast <span style="color: #ff00ff;">192.168.0.255</span>
<span style="color: #804040;"> 29 </span>    gateway <span style="color: #ff00ff;">192.168.0.1</span>
<span style="color: #804040;"> 30 </span>iface eth0:1 inet static
<span style="color: #804040;"> 31 </span>    address <span style="color: #ff00ff;">192.168.0.200</span>
<span style="color: #804040;"> 32 </span>    network <span style="color: #ff00ff;">192.168.0.0</span>
<span style="color: #804040;"> 33 </span>    netmask <span style="color: #ff00ff;">255.255.255.0</span>

30行到33行在eth0上配置了另外一个地址，这种配置方法在配置一块网卡多个地址的时候很常见：有几个地址就配置几个接口。冒号后面的数字可以随便写的，只要几个配置的名字不重复就可以。

下面是pre-up和post-down命令时间。这是一组命令（pre-up、up、post-up、pre-down、down、post-down），分别定义在对应的时刻需要执行的命令。

> <span style="color: #804040;"> 34 </span>auto eth0
<span style="color: #804040;"> 35 </span>iface eth0 inet dhcp
<span style="color: #804040;"> 36 </span>    pre-up [ -f /etc/network/local-network-ok ]

第36行会在激活eth0之前检查/etc/network/local-network-ok文件是否存在，如果不存在，则不会激活eth0。

再更进一步的例子：

> <span style="color: #804040;"> 37 </span>auto eth0 eth1
<span style="color: #804040;"> 38 </span>iface eth0 inet static
<span style="color: #804040;"> 39 </span>    address <span style="color: #ff00ff;">192.168.42.1</span>
<span style="color: #804040;"> 40 </span>    netmask <span style="color: #ff00ff;">255.255.255.0</span>
<span style="color: #804040;"> 41 </span>    pre-up /path/to/check-mac-address.sh eth0 <span style="color: #ff00ff;">11:22:33:44:55:66</span>
<span style="color: #804040;"> 42 </span>    pre-up /usr/local/sbin/enable-masq
<span style="color: #804040;"> 43 </span>iface eth1 inet dhcp
<span style="color: #804040;"> 44 </span>    pre-up /path/to/check-mac-address.sh eth1 <span style="color: #ff00ff;">AA:BB:CC:DD:EE:FF</span>
<span style="color: #804040;"> 45 </span>    pre-up /usr/local/sbin/firewall

第41行和第44行中，check-mac-address.sh放在/usr/share/doc/ifupdown/examples/目录 中，使用的时候需要给它加上可执行权限。这两行命令会检测两块网卡的MAC地址是否为11:22:33:44:55:66和 AA:BB:CC:DD:EE:FF，如果正确，则启用网卡。如果MAC地址错误，就不会启用这两块网卡。

第42行和第45行是假定在这两块网卡上分别执行的命令，你可以把它们替换成你想要的任何玩意 ：）

手册上说，这种方法主要是用来检测两块网卡的MAC地址交换（If their MAC addresses get swapped），其实就是两块网卡名互换了，这种情况在debian系统上再常见不过了，主要是因为内核识别网卡的顺序发生了变化。这个问题可以用下面 的这种方法来避免。

> <span style="color: #804040;">46 </span>auto eth0 eth1
<span style="color: #804040;">47 </span>mapping eth0 eth1
<span style="color: #804040;">48 </span>    script /path/to/get-mac-address.sh
<span style="color: #804040;">49 </span>    map <span style="color: #ff00ff;">11:22:33:44:55:66</span> lan
<span style="color: #804040;">50 </span>    map <span style="color: #ff00ff;">AA:BB:CC:DD:EE:FF</span> internet
<span style="color: #804040;">51 </span>iface lan inet static
<span style="color: #804040;">52 </span>    address <span style="color: #ff00ff;">192.168.42.1</span>
<span style="color: #804040;">53 </span>    netmask <span style="color: #ff00ff;">255.255.255.0</span>
<span style="color: #804040;">54 </span>    pre-up /usr/local/sbin/enable-masq <span style="color: #0000ff;">$IFACE</span>
<span style="color: #804040;">55 </span>iface internet inet dhcp
<span style="color: #804040;">56 </span>    pre-up /usr/local/sbin/firewall <span style="color: #0000ff;">$IFACE</span>

第48行中的get-mac-address.sh也在/usr/share/doc/ifupdown/examples/目录里，也同样要加可执行权限。这个脚本的作用，就是获得每块网卡的MAC地址。

这段配置首先配置了两个逻辑接口（这个名词的定义请参见<a href="http://www.debian.org/doc/manuals/reference/ch-gateway.zh-cn.html#s-net-reconf" target="_blank">debian参考手册</a>）lan和internet，然后根据网卡的MAC地址，将逻辑接口映射（mapped）到物理接口上去。

再来看下面这段配置：

> <span style="color: #804040;">57 </span>auto eth0  <span style="color: #804040;">58 </span>iface eth0 inet manual  <span style="color: #804040;">59 </span>      up ifconfig <span style="color: #0000ff;">$IFACE</span> <span style="color: #ff00ff;">0.0.0.0</span> up  <span style="color: #804040;">60 </span>      up /usr/local/bin/myconfigscript  <span style="color: #804040;">61 </span>      down ifconfig <span style="color: #0000ff;">$IFACE</span> down

这段配置只是启用一个网卡，但是ifupdown不对这个网卡设置任何ip，而是由外部程序来设置ip。

最后一段配置，这段配置启用了网卡的混杂模式，用来当监听接口。

> <span style="color: #804040;">177 </span>auto eth0
<span style="color: #804040;">178 </span>iface eth0 inet manual
<span style="color: #804040;">179 </span>    up ifconfig <span style="color: #0000ff;">$IFACE</span> <span style="color: #ff00ff;">0.0</span>.<span style="color: #ff00ff;">0.0</span> up
<span style="color: #804040;">180 </span>      up ip link set <span style="color: #0000ff;">$IFACE</span> promisc on
<span style="color: #804040;">181 </span>      down ip link set <span style="color: #0000ff;">$IFACE</span> promisc off
<span style="color: #804040;">182 </span>      down ifconfig <span style="color: #0000ff;">$IFACE</span> down

#####WLAN#####

# The wireless network interface （配置无线网络接口）

# 开机自动激活wlan0接口

auto wlan0

# 配置wlan0接口为DHCP自动获取

iface wlan0 inet dhcp