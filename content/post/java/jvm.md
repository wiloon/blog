---
title: jvm
author: "-"
date: ""
url: ""
categories:
  - java
tags:
  - inbox
---
## jvm
JVM是Java Virtual Machine (Java虚拟机）的缩写

常用jvm
目前市面上普遍使用的JVM大致有三种

- Sun公司的HotSpot——绝大多数java开发者都用的是这款，绝对的主力
- Oracle公司的JRockit——这款主要用于金融和军事
- IBM公司的J9 VM——这款是IBM硬件绑定的，用户也很少

IBM 开源了它开发的 J9 Java 虚拟机 (JVM)，并将其贡献给了 Eclipse 基金会，重命名为 Eclipse OpenJ9。J9 是一个高性能可伸缩的 Java 虚拟机，是许多 IBM 企业级软件产品的核心，OpenJ9 可作为 Hotspot 的替代者用于 OpenJDK

Java虚拟机四大组成部分
- 执行引擎(解释器和即时编译器)
- 类加载器
- 运行时数据区
- 垃圾回收器

### 执行引擎 Execution Engine
Java虚拟机的执行引擎主要是用来执行Java字节码。JVM的执行引擎执行字节码通过两种解释器执行的：字节码解释器与模板解释器，运行过程中，可能会触发即时编译 (JIT），涉及到几种即时编译器，下面分别进行介绍。
执行引擎是Java虛拟机核心的组成部分之一。


虚拟机是一个相对于“物理机”的概念，这两种机器都有代码执行能力，其区别是物理机的执行引擎是直接建立在处理器、缓存、指令集和操作系统层面上的，而虚拟机的执行引擎则是由软件自行实现的，因此可以不受物理条件制约地定制指令集与执行引擎的结构体系，能够执行那些不被硬件直接支持的指令集格式。


JVM的主要任务是负责装载字节码到其内部，但字节码并不能够直接运行在操作系统之上，因为字节码指令并非等价于本地机器指令，它内部包含的仅仅只是一些能够被JVM所识别的字节码指令、符号表，以及其他辅助信息。


如果想要让一个Java程序运行起来，执行引擎(Execution Engine)的任务就是将字节码指令解释/编译为对应平台上的本地机器指令才可以。简单来说，JVM中的执行引擎充当了将高级语言翻译为机器语言的译者。
 

### 解释器分类
在Java的发展历史里，一共有两套解释执行器，即古老的字节码解释器、现在普遍使用的模板解释器。


字节码解释器：在执行时通过纯软件代码模拟字节码的执行，效率非常低下。


模板解释器：将每一条字节码和一个模板函数相关联，模板函数中直接产生这条字节码执行时的本地机器代码，从而很大程度上提高了解释器的性能。


在HotSpot VM中，解释器主要由Interpreter模块和Code模块构成。

Interpreter模块:实现了解释器的核心功能
Code模块:用于管理HotSpotVM在运行时生成的本地机器指令



JIT编译器(Just In Time Compiler)
就是虚拟机将源代码直接编译成和本地机器平台相关的汇编语言,通过汇编生成机器代码。
现代虚拟机为了提高执行效率，会使用即时编译技术将方法编译成本地机器代码后再执行
Hotspot JIT编译器生成的是汇编代码，保存在方法区的JIT缓存区
本地机器代码不等于机器码，不同平台虚拟机翻译成本地的能识别的指令集，或者说是汇编语言。指令集由不同的架构构成,如：x86指令集
为什么还需要解释器
有些开发人员会感觉到诧异，既然HotSpot VM中已经内置JIT编译器了，那么为什么还需要再使用解释器来“拖累”程序的执行性能呢?比如JRockit VM内部就不包含解释器，字节码全部都依靠即时编译器编译后执行。
首先明确:
当程序启动后，解释器可以马上发挥作用，省去编译的时间，立即执行。编译器要想发挥作用，把代码编译成本地代码，需要一定的执行时间。但编译为本地代码后，执行效率高。
所以:
尽管JRockitVM中程序的执行性能会非常高效，但程序在启动时必然需要花费更长的时间来进行编译。对于服务端应用来说，启动时间并非是关注重点，但对于那些看中启动时间的应用场景而言，或许就需要采用解释器与即时编译器并存的架构来换取一一个平衡点。在此模式下，当Java虛拟器启动时，解释器可以首先发挥作用，而不必等待即时编译器全
部编译完成后再执行，这样可以省去许多不必要的编译时间。随着时间的推移，编译器发挥作用，把越来越多的代码编译成本地代码，获得更高的执行效率。同时，解释执行在编译器进行激进优化不成立的时候，作为编译器的“逃生门”
当虚拟机启动的时候，解释器可以首先发挥作用，而不必等待即时编译器全部编译完成再执行，这样可以省去许多不必要的编译时间。并且随着程序运行时间的推移，即时编译器逐渐发挥作用，根据热点探测功能，将有价值的字节码编译为汇编语言，以换取更高的程序执行效率。

作者：小伙子vae
链接：https://juejin.cn/post/6995362542386151431
来源：稀土掘金
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。

### HotSpot

https://github.com/openjdk/jdk/tree/master/src/hotspot
